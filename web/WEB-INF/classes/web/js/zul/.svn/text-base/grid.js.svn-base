zk.load("zul.zul");zk.Grid=zClass.create();zk.Grid.prototype={initialize:function(A){this.id=A.id;zkau.setMeta(A,this);this.init()},init:function(){this.element=$e(this.id);if(!this.element){return }if(getZKAttr(this.element,"vflex")=="true"){if(zk.ie){this.element.style.overflow="hidden"}var D=this.element.style.height;if(!D||D=="auto"){this.element.style.height="99%"}}this.body=$e(this.id+"!body");this.paging=getZKAttr(this.element,"pg")!=null;if(this.body){this.bodytbl=zk.firstChild(this.body,"TABLE",true);this.head=$e(this.id+"!head");this.foot=$e(this.id+"!foot");if(this.foot){this.foottbl=zk.firstChild(this.foot,"TABLE",true)}if(this.head){this.headtbl=zk.firstChild(this.head,"TABLE",true);this.headrows=this.headtbl.tBodies[this.headtbl.tBodies.length-1].rows;this.hdfaker=this.headtbl.tBodies[0].rows[0];this.bdfaker=this.bodytbl.tBodies[0].rows[0];if(this.foot){this.ftfaker=this.foottbl.tBodies[0].rows[0]}}if(this.bodytbl.tBodies&&this.bodytbl.tBodies[this.head?1:0]){this.bodyrows=this.bodytbl.tBodies[this.head?1:0].rows}}var F=this;if(this.headtbl&&this.headrows.length){var E=true;l_out:for(var C=this.headrows.length;C;){var B=this.headrows[--C];for(var A=B.cells.length;A;){var G=B.cells[--A].firstChild;for(G=G?G.firstChild:G;G;G=G.nextSibling){if(!G.id||(!G.id.endsWith("!hint")&&!G.id.endsWith("!btn"))){E=false;break l_out}}}}if(E){this.head.style.display="none"}else{this.head.style.display=""}}this.body.onscroll=function(){if(F.head){F.head.scrollLeft=F.body.scrollLeft}if(F.foot){F.foot.scrollLeft=F.body.scrollLeft}if(!F.paging){F._render(zk.gecko?200:60)}}},_vflexSize:function(){if(zk.ie6Only){var A=this.element.style.height;this.element.style.height="";this.element.style.height=A}return this.element.offsetHeight-2-(this.head?this.head.offsetHeight:0)-(this.foot?this.foot.offsetHeight:0)},setHgh:function(B){if(getZKAttr(this.element,"vflex")=="true"||(B&&B!="auto"&&B.indexOf("%")<0)){var D=this._vflexSize();if(this.paging){var C=$e(this.id+"!pgit"),A=$e(this.id+"!pgib");if(C){D-=C.offsetHeight}if(A){D-=A.offsetHeight}}if(D<0){D=0}this.body.style.height=D+"px";if(zk.ie&&this.body.offsetHeight){}}else{this.body.style.height="";this.element.style.height=B}},updSize:function(){var A=this.element.style.height;this.setHgh(A);var B=this.element.style.width;if(!B||B=="auto"||B.indexOf("%")>=0){B=zk.revisedSize(this.element,this.element.offsetWidth);if(B<0){B=0}if(B){B+="px"}}if(B){this.body.style.width=B;if(this.head){this.head.style.width=B}if(this.foot){this.foot.style.width=B}}},_beforeSize:function(){var A=this.element.style.width;if(!A||A=="auto"||A.indexOf("%")>=0){if(this.body){this.body.style.width=""}if(this.head){this.head.style.width=""}if(this.foot){this.foot.style.width=""}}},cleanup:function(){this.element=this.body=this.bodytbl=this.bodyrows=this.head=this.headtbl=this.foot=this.foottbl=null},stripe:function(){var A=getZKAttr(this.element,"scOddRow");if(!A||!this.bodyrows){return }for(var B=0,D=true,E=this.bodyrows.length;B<E;++B){var C=this.bodyrows[B];if($visible(C)&&getZKAttr(C,"nostripe")!="true"){zk.addClass(C,A,!D);zk.fire(C,"stripe");D=!D}}},_calcSize:function(){this.updSize();var A=this.body.clientWidth;if(zk.ie){if(this.headtbl&&this.headtbl.offsetWidth!=this.bodytbl.offsetWidth){this.bodytbl.style.width=""}}if(A&&this.body.offsetWidth==this.bodytbl.offsetWidth&&this.body.offsetWidth-A>11){if(--A<0){A=0}this.bodytbl.style.width=A+"px"}if(this.headtbl){if(A){this.head.style.width=A+"px"}if(getZKAttr(this.element,"fixed")!="true"){zul.adjustHeadWidth(this.hdfaker,this.bdfaker,this.ftfaker,this.bodyrows)}}else{if(this.foottbl){if(A){this.foot.style.width=A+"px"}if(this.foottbl.rows.length){zk.cpCellWidth(this.foottbl.rows[0],this.bodyrows,this)}}}},resizeCol:function(D,E,A,B,C){if(this.bodyrows){zulHdr.resizeAll(this,D,E,A,B,C)}},setAttr:function(A,C){switch(A){case"z.innerWidth":if(this.headtbl){this.headtbl.style.width=C}if(this.bodytbl){this.bodytbl.style.width=C}if(this.foottbl){this.foottbl.style.width=C}return true;case"style.height":this.element.style.height=C;if(zk.ie6Only&&this.body){this.body.style.height=C}this.setHgh(C);this._recalcSize();return true;case"style.width":if(this.headtbl){this.headtbl.style.width=""}if(this.foottbl){this.foottbl.style.width=""}case"style":zkau.setAttr(this.element,A,C);this._recalcSize();return true;case"z.scOddRow":zkau.setAttr(this.element,A,C);this.stripe();return true;case"z.render":this._render(0);return true;case"scrollTop":if(this.body){this.body.scrollTop=C;return true}break;case"scrollLeft":if(this.body){this.body.scrollLeft=C;return true}case"z.vflex":if(C=="true"){if(zk.ie){this.element.style.overflow="hidden"}var B=this.element.style.height;if(!B||B=="auto"){this.element.style.height="99%"}}else{if(zk.ie){this.element.style.overflow=""}}zkau.setAttr(this.element,A,C);this._recalcSize();return true}return false},_render:function(A){if(!this.paging||getZKAttr(this.element,"hasgroup")){setTimeout("zkGrid._renderNow('"+this.id+"')",A)}},_renderNow:function(){var F=this.bodyrows;if(!F||!F.length||getZKAttr(this.element,"model")!="true"){return }var E="";var C=this.body.scrollTop,A=C+this.body.offsetHeight;for(var B=0,H=F.length;B<H;++B){var D=F[B];if($visible(D)){var G=zk.offsetTop(D);if(G+zk.offsetHeight(D)<C){continue}if(G>A){break}if(getZKAttr(D,"loaded")!="true"){E+=","+D.id}else{if(getZKAttr(D,"inited")!="true"){zk.initAt(D)}}}}if(E){E=E.substring(1);zkau.send({uuid:this.id,cmd:"onRender",data:[E]},0)}},_recalcSize:function(){if(zk.isRealVisible(this.element)){this._calcSize();this._render(155);if(zk.ie7){zk.repaint(this.element)}}}};zkGrid={};zkGrid.init=function(A){var B=zkau.getMeta(A);if(B){B.init()}else{new zk.Grid(A)}};zkGrid.childchg=function(A){var B=zkau.getMeta(A);if(B){B.init();B._recalcSize()}};zkGrid.onVisi=zkGrid.onSize=function(A){var B=zkau.getMeta(A);if(B){B._recalcSize()}};zkGrid.beforeSize=function(A){var B=zkau.getMeta(A);if(B){B._beforeSize()}};zkGrid.stripe=function(A){var B=zkau.getMeta(A);if(B){B.stripe()}};zkGrid.setAttr=function(B,A,D){var C=zkau.getMeta(B);return C&&C.setAttr(A,D)};zkGrid._renderNow=function(A){var B=zkau.getMeta(A);if(B){B._renderNow()}};zkGrw={};zkGrw.init=function(A){setZKAttr(A,"inited","true");zkGrw.stripe(A)};zkGrw.initdrag=function(A){if(zk.gecko){zk.listen(A,"mouseover",zkGrw.ondragover);zk.listen(A,"mouseout",zkGrw.ondragout)}};zkGrw.cleandrag=function(A){if(zk.gecko){zk.unlisten(A,"mouseover",zkGrw.ondragover);zk.unlisten(A,"mouseout",zkGrw.ondragout)}};zkGrw.ondragover=function(B){var D=Event.element(B);var A=$tag(D);if(A!="INPUT"&&A!="TEXTAREA"){var C=$parentByType(D,"Gcl");if(C){C.firstChild.style.MozUserSelect="none"}}};zkGrw.ondragout=function(A){var C=Event.element(A);var B=$parentByType(C,"Gcl");if(B){B.firstChild.style.MozUserSelect=""}};zkGrw.cleanup=function(A){zkGrw.stripe(A,true)};zkGrw.setAttr=function(B,A,D){if(A=="visibility"){var C=zkau.getMeta(getZKAttr(B,"rid"));if(C){if(!C.fixedStripe){C.fixedStripe=function(){C.stripe()}}setTimeout(C.fixedStripe,0)}}return false};zkGrw.stripe=function(B,A){var C=zkau.getMeta(getZKAttr(B,"rid"));if(C){if(!C.fixedStripe){C.fixedStripe=function(){C.stripe()}}if(A){zk.addCleanupLater(C.fixedStripe,false,C.id+"Grw")}else{zk.addInitLater(C.fixedStripe,false,C.id+"Grw")}}};zkGcl={};zk.addBeforeInit(function(){zkCol={};Object.extend(zkCol,zulHdr);zkCol.resize=function(F,D,B,C){var A=getZKAttr(F.parentNode,"rid");if(A){var E=zkau.getMeta(A);if(E){E.resizeCol($parentByType(F,"Cols"),D,F,B,C)}}};zk.apply(zkCol,{_zkColinit:zkCol.init,init:function(C){zkCol._zkColinit(C);var A=getZKAttr(C.parentNode,"mpop");zk.listen(C,"mouseover",zkCol.onHdOver);zk.listen(C,"mouseout",zkCol.onHdOut);if(A!="zk_n_a"){var B=$e(C,"btn");if(B){zk.listen(B,"click",zkCol.onMenuClick);zk.addInitLater(function(){var D=$e(A);if(!D){D=zkau.getByZid(C.parentNode,A)}if(D){if(getZKAttr(D,"autocreate")=="true"&&getZKAttr(C.parentNode,"columnshide")!="true"&&getZKAttr(C,"asc")!="true"&&getZKAttr(C,"dsc")!="true"){zk.remove($e(C.id+"!btn"))}zk.on(D,"close",zkCol.onMenuClose);zk.on(D,"onOuter",zkCol.onMenuOuter)}})}}},onMenuOuter:function(A){zk.on(A,"close",zkCol.onMenuClose)},onMenuClick:function(I){if(!I){I=window.event}var E=$parentByType(Event.element(I),"Col"),B=zkau.getByZid(E.parentNode,getZKAttr(E.parentNode,"mpop")),A=$e(E,"btn");if(!B){return }zk.addClass(E,getZKAttr(E,"zcls")+"-visi");if(getZKAttr(B,"autocreate")=="true"){var H=getZKAttr(E.parentNode,"columnsgroup")=="true",F=getZKAttr(E,"asc")=="true",C=getZKAttr(E,"dsc")=="true";var D=$e(B,"cave");if(D){var G=zk.firstChild(D,"LI");if(H){G.style.display=F||C?"":"none";G=zk.nextSibling(G,"LI")}if(G){G.style.display=F?"":"none"}G=zk.nextSibling(G,"LI");if(G){G.style.display=C?"":"none"}}}B.style.position="absolute";zk.setVParent(B);zk.position(B,A,"after_start");var K=zk.revisedOffset(E),J=$int(B.style.top);if(K[1]<J){B.style.top=J-4+"px"}zkMpop2.context(B,E);setZKAttr(B,"menuId",E.id);Event.stop(I)},onMenuClose:function(A){var B=$e(getZKAttr(A,"menuId")),C=getZKAttr(B,"zcls");zk.rmClass(B,C+"-visi");zk.rmClass(B,C+"-over");return false},onHdOver:function(A){if(!A){A=window.event}var C=$parentByType(Event.element(A),"Col");zk.addClass(C,getZKAttr(C,"zcls")+"-over");var B=$e(C,"btn");if(B){B.style.height=C.offsetHeight-1+"px"}},onHdOut:function(A){if(!A){A=window.event}var B=$parentByType(Event.element(A),"Col"),C=getZKAttr(B,"zcls");if(!zk.hasClass(B,C+"-visi")&&(!zk.ie||!zk.isAncestor(B,A.relatedTarget||A.toElement))){zk.rmClass(B,C+"-over")}}});zkCols=zulHdrs});zkGrwgp={init:function(E){setZKAttr(E,"inited","true");E._img=zk.firstChild(E,"IMG",true);if(E._img){zk.listen(E._img,"click",zkGrwgp.ontoggle)}var D=E.parentNode.parentNode;if(D.tBodies.length>1){var C=0;for(var F=D.rows[0],B=F.cells.length;--B>=0;){if(zk.isVisible(F.cells[B])){C++}}for(var A=E.cells,B=A.length;--B>=0;){C-=A[B].colSpan}if(C>0&&E.cells.length){E.cells[E.cells.length-1].colSpan+=C}}},ontoggle:function(A){if(!A){A=window.event}var D=Event.element(A);var E=zk.parentNode(D,"TR");if(!E){return }var C=zkau.getMeta(getZKAttr(E,"rid"));var B=!zkGrwgp.isOpen(E);zkGrwgp._openItem(E,B);if(B&&C||getZKAttr(C.element,"model")=="true"){if(B){C.stripe()}if(!C.paging){C._recalcSize()}}Event.stop(A)},isOpen:function(A){return getZKAttr(A,"open")=="true"},_openItem:function(C,B,A){setZKAttr(C,"open",B?"true":"false");if(C._img){if(B){zk.rmClass(C._img,getZKAttr(C,"zcls")+"-img-close");zk.addClass(C._img,getZKAttr(C,"zcls")+"-img-open")}else{zk.rmClass(C._img,getZKAttr(C,"zcls")+"-img-open");zk.addClass(C._img,getZKAttr(C,"zcls")+"-img-close")}}zkGrwgp._openItemNow(C,B);if(!A){zkau.sendasap({uuid:C.id,cmd:"onOpen",data:[B]})}},_openItemNow:function(E,A){for(var D=E.parentNode.parentNode,C=E.rowIndex+1,B=D.rows.length;C<B;C++){if($type(D.rows[C])=="Grwgp"||$type(D.rows[C])=="Grwgpft"){break}if(getZKAttr(D.rows[C],"visible")=="true"){D.rows[C].style.display=A?"":"none"}}},cleanup:function(D){D._img=null;var C,B=D.parentNode.parentNode;for(var A=D.rowIndex-1;--A>=0;){if($type(B.rows[A])=="Grwgp"){C=B.rows[A];break}}if(C){zk.addCleanupLater(function(){C=$e(C.id);if(C){zkGrwgp._openItem(C,zkGrwgp.isOpen(C),true)}},false,D.id)}else{zkGrwgp._openItemNow(D,true)}},setAttr:function(B,A,D){if(A=="z.open"){zkGrwgp._openItem(B,"true"==D,true);if("true"==D){var C=zkau.getMeta(getZKAttr(row,"rid"));if(C){C.stripe()}}return true}return false},initdrag:zkGrw.initdrag,cleandrag:zkGrw.cleandrag};zkGrwgp.onVisi=zkGrwgp.onSize=function(A){zkGrwgp._openItem(A,zkGrwgp.isOpen(A),true);zkGrw.stripe(A)};zkGrwgpft={init:function(A){setZKAttr(A,"inited","true")},initdrag:zkGrw.initdrag,cleandrag:zkGrw.cleandrag,ondragover:zkGrw.ondragover,ondragout:zkGrw.ondragout};