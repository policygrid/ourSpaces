zk.load("zul.widget");zk.Slider=zClass.create();zk.Slider.prototype={initialize:function(A){this.id=A.id;zkau.setMeta(A,this);this.init(A)},cleanup:function(){if(this.draggable){this.draggable.destroy();this.draggable.slider=null;this.draggable=null}if(this.fnSubmit){zk.unlisten(this.form,"submit",this.fnSubmit)}this.element=this.fnSubmit=null},init:function(B){this.cleanup();this.element=$e(this.id);if(!this.element){return }this.button=$e(this.id+"!btn");this.vert=getZKAttr(B,"vert");var C=this;var A=function(D,E){return C._snap(D,E)};this.draggable=new zDraggable(this.button,{constraint:this.vert?"vertical":"horizontal",snap:A,starteffect:zkSld._startDrag,change:zkSld._dragging,endeffect:zkSld._endDrag});this.form=zk.formOf(this.element);if(this.form&&!this.fnSubmit){this.fnSubmit=function(){C.onsubmit()};zk.listen(this.form,"submit",this.fnSubmit)}},_snap:function(B,D){var C=zPos.cumulativeOffset(this.element);C=zk.toStyleOffset(this.button,C[0],C[1]);if(B<=C[0]){B=C[0]}else{var A=C[0]+this._width();if(B>A){B=A}}if(D<=C[1]){D=C[1]}else{var A=C[1]+this._height();if(D>A){D=A}}return[B,D]},_fixPos:function(){if(this.vert){var B=this._height();var A=B>0?Math.round((this._curpos()*B)/this._maxpos()):0;var D=zPos.cumulativeOffset(this.element);D=zk.toStyleOffset(this.button,D[0],D[1]);D=this._snap(0,D[1]+A);this.button.style.top=D[1]+"px"}else{var C=this._width();var A=C>0?Math.round((this._curpos()*C)/this._maxpos()):0;var D=zPos.cumulativeOffset(this.element);D=zk.toStyleOffset(this.button,D[0],D[1]);D=this._snap(D[0]+A,0);this.button.style.left=D[0]+"px"}},_startDrag:function(){this.button.title="";this.slidepos=this._curpos();document.body.insertAdjacentHTML("beforeend",'<div id="zul_slidetip" class="z-slider-pp" style="position:absolute;display:none;z-index:60000;background-color:white;border: 1px outset">'+this.slidepos+"</div>");this.slidetip=$e("zul_slidetip");if(this.slidetip){this.slidetip.style.display="block";zk.position(this.slidetip,this.element,this.vert?"end_before":"after-start")}},_dragging:function(){var A=this._realpos();if(A!=this.slidepos){this.slidepos=A;if(this.slidetip){this.slidetip.innerHTML=getZKAttr(this.element,"slidingtext").replace(/\{0\}/g,A)}if(zkau.asap(this.element,"onScrolling")){zkau.send({uuid:this.element.id,cmd:"onScrolling",data:[A],ignorable:true},100)}}},_endDrag:function(){var B=this._realpos();var A=this._curpos();if(B!=A){setZKAttr(this.element,"curpos",B);zkau.sendasap({uuid:this.element.id,cmd:"onScroll",data:[B]})}this._fixPos();this.button.title=B;zk.remove(this.slidetip);this.slidetip=null},_realpos:function(){var A=zPos.cumulativeOffset(this.button);var E=zPos.cumulativeOffset(this.element);var C=this._maxpos();var F;if(this.vert){var B=this._height();F=B?Math.round(((A[1]-E[1])*C)/B):0}else{var D=this._width();F=D?Math.round(((A[0]-E[0])*C)/D):0}return F>=0?F:0},_curpos:function(){return $int(getZKAttr(this.element,"curpos"))},_maxpos:function(){return $int(getZKAttr(this.element,"maxpos"))},_width:function(){return this.element.clientWidth-this.button.offsetWidth},_height:function(){return this.element.clientHeight-this.button.offsetHeight},onsubmit:function(){var A=getZKAttr(this.element,"name");if(!A||!this.form){return }var C=this._curpos(),B=this.form.elements[A];if(B){B.value=C}else{zk.newHidden(A,C,this.form)}}};zkSld={down_btn:null,init:function(D){var E=zkau.getMeta(D),B=getZKAttr(D,"vert");if(E){E.init()}else{new zk.Slider(D)}var C=$e(D.id+"!btn"),A=$e(D.id+"!inner");if(B){var F=D.clientHeight-14;A.style.height=F+"px"}zk.listen(C,"mouseover",zkSld.onover);zk.listen(C,"mouseout",zkSld.onout);zk.listen(C,"mousedown",zkSld.ondown);zk.listen(C,"mouseup",zkSld.onup)},onover:function(A){if(!A){A=window.event}var C=$outer(Event.element(A)),B=$e(C.id+"!btn");zcls=getZKAttr(C,"zcls");zk.addClass(B,zcls+"-btn-over")},onout:function(A){if(!A){A=window.event}var C=$outer(Event.element(A)),B=$e(C.id+"!btn");if(B!=zkSld.down_btn){var D=getZKAttr(C,"zcls");zk.rmClass(B,D+"-btn-over")}},ondown:function(A){if(!A){A=window.event}var C=$outer(Event.element(A)),B=$e(C.id+"!btn"),D=getZKAttr(C,"zcls");zk.addClass(B,D+"-btn-drag");zkSld.down_btn=B;zk.listen(document.body,"mouseup",zkSld.onup)},onup:function(A){if(!A){A=window.event}var C=$outer(Event.element(A));var B=zkSld.down_btn;if(B){var D=getZKAttr($real(B),"zcls");zk.rmClass(B,D+"-btn-drag");zk.rmClass(B,D+"-btn-over")}zkSld.down_btn=null;zk.unlisten(document.body,"mouseup",zkSld.onup)},_startDrag:function(A){var B=zkSld._metaByBtn(A);return B?B._startDrag():null},_endDrag:function(A){var B=zkSld._metaByBtn(A);return B?B._endDrag(A):null},_dragging:function(A){var B=zkSld._metaByBtn(A.element);return B?B._dragging():null},_metaByBtn:function(A){var B=A.id;return zkau.getMeta(B.substring(0,B.length-4))},setAttr:function(B,A,D){if("z.curpos"==A){setZKAttr(B,"curpos",D);var C=zkau.getMeta(B);if(C){C._fixPos(B)}return true}else{if("z.slidingtext"==A){setZKAttr(B,"slidingtext",D);return true}}return false}};zkSld.onVisi=zkSld.onSize=function(A){var B=zkau.getMeta(A);if(B){B._fixPos(A)}};