zk.load("zul.vd");zkTmbox={POS_MIN:"1",POS_HOUR:"2"};zkTmbox.init=function(C){zkTmbox.onVisi=zkTmbox.onSize=zul.onFixDropBtn;zkTmbox.onHide=zkTxbox.onHide;zkTxbox.init($real(C));C.lastTime=new Date();C.lastTime.setHours(0);C.lastTime.setMinutes(0);C.lastTimeStr="";C.changed=false;C.currentStep=1;C.defaultStep=1;C.lastPos=0;C.runCount=0;C.timerId=null;var B=$real(C);var A=$e(C.id+"!btn");zk.listen(B,"focus",zkTmbox._inpfocus);zk.listen(B,"blur",zkTmbox._inpblur);zk.listen(B,"click",zkTmbox._inpclick);zk.listen(B,"keydown",zkTmbox._inpkeydown);if(A){zk.listen(A,"mousedown",zkTmbox._btnDown);zk.listen(A,"mouseup",zkTmbox._btnUp);zk.listen(A,"click",zk.doEventStop);zk.listen(A,"mouseout",zkTmbox._btnOut);zk.listen(A,"mouseover",zul.ondropbtnover)}if(B.value){zkTmbox._setTime(C,B.value)}else{zkTmbox._clearTime(C)}};zkTmbox.cleanup=function(A){if(A.timerId){clearTimeout(A.timerId);A.timerId=null}zkTxbox.cleanup(A)};zkTmbox.setAttr=function(D,A,E){if("value"==A){if(E){zkTmbox._setTime(D,E)}else{zkTmbox._clearTime(D)}var F=$real(D);if(F.defaultValue!=F.value){F.defaultValue=F.value}return true}else{if("z.btnVisi"==A){var B=$e(D.id+"!btn");if(B){B.style.display=E=="true"?"":"none"}zul.onFixDropBtn(D);return true}else{if("style"==A){var C=$real(D);if(C){zkau.setAttr(C,A,zk.getTextStyle(E,true,true))}}else{if("style.width"==A){var C=$real(D);if(C){C.style.width=E;return true}}else{if("style.height"==A){var C=$real(D);if(C){C.style.height=E;return true}}}}}}zkau.setAttr(D,A,E);return true};zkTmbox.rmAttr=function(C,A){if("style"==A){var B=$real(C);if(B){zkau.rmAttr(B,A)}}else{if("style.width"==A){var B=$real(C);if(B){B.style.width=""}}else{if("style.height"==A){var B=$real(C);if(B){B.style.height=""}}}}zkau.rmAttr(C,A);return true};zkTmbox._inpfocus=function(B){if(!B){B=window.event}var C=$outer(Event.element(B));var A=zkTmbox._selrange(C);C.lastPos=A[0]};zkTmbox._inpblur=function(A){if(!A){A=window.event}var C=$outer(Event.element(A));var B=$real(C);if(!zkTmbox._check(B.value)){zkTmbox.setTime(C,C.lastTimeStr)}};zkTmbox._inpclick=function(B){if(!B){B=window.event}var C=$outer(Event.element(B));var A=zkTmbox._selrange(C);C.lastPos=A[0]};zkTmbox._inpkeydown=function(B){if(!B){B=window.event}var E=Event.element(B),D=$outer(E),A=zkTmbox._selrange(D);if(E.disabled||E.readOnly){return }D.lastPos=A[0];var C=Event.keyCode(B);switch(C){case 48:case 96:case 49:case 97:case 50:case 98:case 51:case 99:case 52:case 100:case 53:case 101:case 54:case 102:case 55:case 103:case 56:case 104:case 57:case 105:C=C-(C>=96?96:48);zkTmbox._setTimeDigit(D,C);Event.stop(B);break;case 37:break;case 38:zkTmbox.onUp(D);Event.stop(B);break;case 39:break;case 40:zkTmbox.onDown(D);Event.stop(B);break;case 46:zkTmbox.clearTime(D);Event.stop(B);break;case 13:case 27:case 9:case 35:case 36:break;default:if(!(C>=112&&C<=123)&&!B.ctrlKey&&!B.altKey){Event.stop(B)}}};zkTmbox._btnDown=function(A){if(!A){A=window.event}var D=$outer(Event.element(A)),C=$real(D);if(C.disabled||zk.dragging){return }var B=zk.opera||zk.safari?$e(D.id+"!btn"):zk.firstChild($e(D.id+"!btn"),"IMG"),E=zk.revisedOffset(B);if((Event.pointerY(A)-E[1])<B.offsetHeight/2){zkTmbox.onUp(D);zkTmbox._startAutoIncProc(D,true)}else{zkTmbox.onDown(D);zkTmbox._startAutoIncProc(D,false)}zk.listen(B,"mousedown",zul.ondropbtndown)};zkTmbox._btnUp=function(A){if(!A){A=window.event}var C=$outer(Event.element(A));var B=$real(C);if(B.disabled||zk.dragging){return }zkTxbox.sendOnChanging(B);zkTmbox._stopAutoIncProc(C);zkTmbox._markPositionSel(C);B.focus()};zkTmbox._btnOut=function(A){if(!A){A=window.event}zul.ondropbtnout(A);var C=$outer(Event.element(A));var B=$real(C);if(B.disabled||zk.dragging){return }zkTmbox._stopAutoIncProc(C)};zkTmbox._selrange=function(B){var C=zk.getSelectionRange($real(B));if(C[0]>C[1]){var A=C[1];C[1]=C[0];C[0]=A}return C};zkTmbox._calInc=function(A){var B=zkTmbox._checkPosition(A);switch(B){case zkTmbox.POS_MIN:return 60;break;case zkTmbox.POS_HOUR:return 3600;break;default:return 0}};zkTmbox.onUp=function(A){zkTmbox._increaseTime(A,zkTmbox._calInc(A));zkTmbox._markPositionSel(A)};zkTmbox.onDown=function(A){zkTmbox._increaseTime(A,-zkTmbox._calInc(A));zkTmbox._markPositionSel(A)};zkTmbox._checkPosition=function(A){return A.lastPos<=2?zkTmbox.POS_HOUR:zkTmbox.POS_MIN};zkTmbox._markPositionSel=function(A){var B=zkTmbox._checkPosition(A);switch(B){case zkTmbox.POS_HOUR:zkTmbox._markselection(A,0,2);break;case zkTmbox.POS_MIN:zkTmbox._markselection(A,3,5);break}};zkTmbox._check=function(C){if(!C){return false}var B=C.split(":");if(B.length==2){var A=$int(B[0]);var D=$int(B[1]);var E=false;if(isNaN(A)||A>23||A<0){return false}if(isNaN(D)||D>59||D<0){return false}return true}return false};zkTmbox._increaseTime=function(E,F){var D=E.lastTime.getTime();D=D+1000*F*E.currentStep;var B=new Date();B.setTime(D);var A=B.getHours();var C=B.getMinutes();var G=zk.formatFixed(A,2)+":"+zk.formatFixed(C,2);zkTmbox.setTime(E,G)};zkTmbox._setTimeDigit=function(C,G){var D=zkTmbox._selrange(C);var A=C.lastTime.getHours();var B=C.lastTime.getMinutes();var E=0;switch(D[0]){case 0:if(G>2){A=G;E=3}else{A=A%10+G*10;E=1}if(A>23){return }break;case 1:A=A-A%10+G;if(A>23){return }E=3;break;case 3:if(G>5){B=G}else{B=B%10+G*10}if(B>59){return }E=4;break;case 4:B=B-B%10+G;if(B>59){return }E=4;break;default:return }var F=zk.formatFixed(A,2)+":"+zk.formatFixed(B,2);zkTmbox.setTime(C,F);zkTmbox._markselection(C,E,E)};zkTmbox._setTime=function(F,C){if(F.lastTimeStr==C){return false}if(!zkTmbox._check(C)){return false}var E=$real(F);var B=C.split(":");var A=$int(B[0]);var D=$int(B[1]);var G=zk.formatFixed(A,2)+":"+zk.formatFixed(D,2);F.lastTime.setHours(A);F.lastTime.setMinutes(D);E.value=G;F.lastTimeStr=G;return true};zkTmbox.setTime=function(B,A){if(zkTmbox._setTime(B,A)){B.changed=true}};zkTmbox._clearTime=function(A){if(!A.lastTimeStr){return false}A.lastTimeStr="";A.lastTime.setHours(0);A.lastTime.setMinutes(0);$real(A).value="";return true};zkTmbox.clearTime=function(A){if(zkTmbox._clearTime(A)){A.changed=true}};zkTmbox._autoIncTimeout=function(A,B){zkTmbox._increaseTime(A,B);if(A.timerId){if(A.runCount!=0&&(A.runCount%10)==0){A.currentStep=A.currentStep+1}A.runCount=A.runCount+1;zkTxbox.sendOnChanging($real(A))}};zkTmbox._startAutoIncProc=function(B,A){if(B.timerId){clearInterval(B.timerId)}var C=zkTmbox._calInc(B);if(!A){C=-C}B.timerId=setInterval(function(){zkTmbox._autoIncTimeout(B,C)},500)};zkTmbox._stopAutoIncProc=function(A){if(A.timerId){clearTimeout(A.timerId)}A.currentStep=A.defaultStep;A.runCount=0;A.timerId=null};zkTmbox._markselection=function(D,E,A){var C=$real(D);if(C.setSelectionRange){C.setSelectionRange(E,A);C.focus()}else{if(C.createTextRange){var B=C.createTextRange();if(E!=A){B.moveEnd("character",A-B.text.length);B.moveStart("character",E)}else{B.move("character",E)}B.select()}}};